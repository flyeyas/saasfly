# HTML5游戏网站数据库模型完善说明

## 概述

根据 `HTML5游戏网站需求梳理.md` 中的需求，已完善了数据库模型，新增了完整的游戏网站功能支持。

## 已完善的数据库模型

### 1. 核心游戏模型

#### Game（游戏表）
- **多语言支持**: title、description、gameplayGuide等字段支持JSON格式存储多语言内容
- **媒体资源**: 支持封面图、缩略图、游戏截图数组
- **游戏信息**: 难度等级、预估时长、开发者信息、游戏故事、操作说明
- **统计数据**: 播放次数、分享次数、平均评分、评分数量
- **状态管理**: 激活状态、精选状态

#### Category（分类表）
- **多语言支持**: name、description支持多语言
- **层级结构**: 支持父子分类关系
- **视觉元素**: 分类图标支持
- **排序管理**: sortOrder字段支持自定义排序

#### GameCategory（游戏分类关联表）
- 多对多关系，支持一个游戏属于多个分类
- 级联删除保护数据完整性

### 2. 标签系统

#### GameTag（游戏标签表）
- **多语言标签**: 支持英文、中文等多语言标签名称
- **视觉标识**: 颜色、图标支持
- **使用统计**: usageCount字段追踪标签使用频率
- **SEO优化**: slug字段支持URL友好的标签页面

#### GameTagRelation（游戏标签关联表）
- 游戏与标签的多对多关系
- 支持灵活的标签分类和筛选

### 3. 用户交互系统

#### GameRating（游戏评分表）
- 1-5星评分系统
- 每个用户对每个游戏只能评分一次
- 支持评分统计和平均分计算

#### GameComment（游戏评论表）
- **层级评论**: 支持评论回复功能
- **社交互动**: 点赞数统计
- **内容管理**: isActive字段支持评论审核
- **自引用关系**: 使用Restrict策略防止循环删除

#### GameFavorite（游戏收藏表）
- 用户收藏游戏功能
- 唯一约束防止重复收藏
- 支持个人收藏列表展示

### 4. 内容增强系统

#### GameGuide（游戏攻略表）
- **多语言攻略**: 标题和内容支持多语言
- **难度分级**: beginner、intermediate、advanced
- **官方标识**: isOfficial字段区分官方和用户攻略
- **互动统计**: 查看数、点赞数统计

#### SocialShare（社交分享记录表）
- **平台追踪**: Twitter、Facebook、Reddit等平台分享记录
- **匿名支持**: 支持未登录用户分享（仅记录IP）
- **数据分析**: 用户代理、IP地址记录用于分析

### 5. 排行榜系统

#### GameRanking（游戏排行榜表）
- **多维度排行**: popular、new、trending、featured等类型
- **时间周期**: daily、weekly、monthly、all_time
- **综合评分**: score字段支持复杂排名算法
- **位置追踪**: position字段记录具体排名

### 6. 用户成就系统

#### UserAchievement（用户成就表）
- **成就类型**: completed、high_score、time_record等
- **成就值**: 支持分数、时间等不同类型的成就记录
- **防重复**: 用户-游戏-成就类型唯一约束

#### GameHistory（游戏历史记录表）
- **游戏时长**: 精确到秒的游戏时间记录
- **完成状态**: 游戏是否通关
- **分数记录**: 游戏得分记录

### 7. 广告管理系统

#### Advertisement（广告表）
- **广告类型**: ADSENSE、BANNER、TEXT、VIDEO
- **广告位置**: HEADER、SIDEBAR、FOOTER、IN_CONTENT、MOBILE_BANNER
- **时间控制**: 开始和结束日期
- **效果统计**: 点击数、展示数追踪

### 8. 系统配置管理

#### SystemConfig（系统配置表）
- **配置分类**: SMTP、WEBSITE、SEO、SECURITY、NOTIFICATION、GENERAL
- **JSON存储**: 支持复杂配置数据结构
- **动态配置**: 支持运行时配置修改

#### EmailTemplate（邮件模板表）
- **多语言邮件**: 主题和内容支持多语言
- **模板类型**: WELCOME、PASSWORD_RESET、EMAIL_VERIFICATION等
- **变量支持**: variables字段说明可用的模板变量

## 数据库关系设计特点

### 1. 多语言支持
- 使用JSON字段存储多语言内容
- 格式：`{"en": "English Content", "zh": "中文内容"}`
- 支持动态语言扩展

### 2. 关联关系优化
- **级联删除**: 子记录随父记录删除（如游戏删除时删除相关评论）
- **限制删除**: 自引用关系使用Restrict防止循环删除
- **空值设置**: 用户删除时社交分享记录保留但用户ID设为空

### 3. 性能优化设计
- **索引优化**: 关键查询字段添加索引
- **唯一约束**: 防止重复数据（如用户重复评分）
- **统计字段**: 预计算统计数据减少查询复杂度

### 4. 扩展性考虑
- **JSON字段**: 支持灵活的数据结构扩展
- **枚举类型**: 便于添加新的类型选项
- **软删除**: isActive字段支持软删除功能

## 已完成的技术实现

1. ✅ **Prisma Schema更新**: 完整的数据库模型定义
2. ✅ **类型生成**: Kysely类型文件生成成功
3. ✅ **数据库同步**: 使用`prisma db push`同步到PostgreSQL数据库
4. ✅ **关系验证**: 所有外键关系和约束验证通过

## 下一步开发建议

1. **API开发**: 基于新模型创建tRPC路由
2. **前端组件**: 开发游戏展示、评论、收藏等UI组件
3. **管理后台**: 实现游戏、分类、标签的CRUD管理界面
4. **数据迁移**: 如有现有数据需要迁移脚本
5. **性能优化**: 根据实际使用情况添加数据库索引

## 模型文件位置

- **Schema文件**: `/packages/db/prisma/schema.prisma`
- **生成的类型**: `/packages/db/prisma/types.ts`
- **枚举定义**: `/packages/db/prisma/enums.ts`

数据库模型现已完全支持HTML5游戏网站的所有核心功能需求，为后续的API开发和前端实现提供了坚实的数据基础。